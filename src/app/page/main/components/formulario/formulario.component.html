<!-- Toast Component -->
<p-toast position="top-right"></p-toast>

<!-- Modal de Carga en Pantalla Completa -->
<p-dialog [(visible)]="showLoadingModal" [modal]="true" [closable]="false" [closeOnEscape]="false"
  [style]="{ width: '100vw', height: '100vh', maxWidth: '100vw' }" [contentStyle]="{
    padding: '0',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
  }" styleClass="loading-modal-fullscreen">

  <div class="flex flex-col items-center justify-center gap-8 text-center">
    <!-- Spinner de Carga -->
    <p-progressSpinner [style]="{ width: '120px', height: '120px' }" strokeWidth="4" fill="transparent"
      animationDuration="1.5s">
    </p-progressSpinner>

    <!-- Texto de Carga -->
    <div class="space-y-4">
      <h2 class="text-3xl font-bold text-white">
        <i class="mr-3 pi pi-spin pi-spinner"></i>
        Cargando Denuncia / Reclamo
      </h2>

      <div *ngIf="selectedFiles.length > 0" class="space-y-2">
        <p class="text-xl text-gray-300">
          <i class="mr-2 pi pi-cloud-upload"></i>
          Subiendo archivos adjuntos
        </p>
        <p class="text-lg text-gray-400">
          {{ selectedFiles.length }} archivo(s) - {{ totalSize }}
        </p>
      </div>

      <p class="text-2xl text-blue-300 animate-pulse">
        Espere unos segundos...
      </p>

      <div class="flex items-center justify-center gap-2 mt-6 text-gray-400">
        <i class="pi pi-shield"></i>
        <span class="text-sm">Procesando su información de forma segura</span>
      </div>
    </div>

    <!-- Indicador Visual Adicional -->
    <div class="flex gap-3">
      <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0s"></div>
      <div class="w-3 h-3 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
      <div class="w-3 h-3 bg-blue-300 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
    </div>
  </div>
</p-dialog>

<!-- Header (fuera del form) -->
<header class="p-6 text-white bg-slate-700">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <i class="text-3xl pi pi-shield"></i>
      <div>
        <h1 class="text-xl font-bold tracking-wide">FORMATO DE DENUNCIA/RECLAMO</h1>
        <p class="text-sm text-gray-300">
          Defensoría Universitaria
        </p>
      </div>
    </div>
    <div class="text-right">
      <div class="text-sm">Fecha: {{ today | date:'dd/MM/yyyy' }}</div>
      <div class="px-3 py-1 mt-1 font-bold bg-red-600 rounded text-md">
        N° Expediente: {{ expediente }}
      </div>
    </div>
  </div>
</header>

<div class="p-6 mx-auto">
  <!-- Form -->
  <form [formGroup]="formularioForm" class="space-y-8">
    <!-- Tipo de Usuario -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-users"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Tipo de Usuario</h2>
            <p class="text-sm text-gray-600">Seleccione su rol en la institución</p>
          </div>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-5">
          <div class="relative">
            <input type="radio" id="estudiante" name="tipoUsuario" value="13" formControlName="tipoUsuario"
              class="sr-only peer">
            <label for="estudiante"
              class="flex items-center gap-3 p-4 transition-all border-2 border-gray-200 border-solid rounded-lg cursor-pointer hover:border-blue-300 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <i class="text-xl text-blue-600 pi pi-user"></i>
              <span class="font-medium text-gray-700">Estudiante</span>
            </label>
          </div>

          <div class="relative">
            <input type="radio" id="docente" name="tipoUsuario" value="12" formControlName="tipoUsuario"
              class="sr-only peer">
            <label for="docente"
              class="flex items-center gap-3 p-4 transition-all border-2 border-gray-200 border-solid rounded-lg cursor-pointer hover:border-green-300 peer-checked:border-green-500 peer-checked:bg-green-50">
              <i class="text-xl text-green-600 pi pi-book"></i>
              <span class="font-medium text-gray-700">Docente</span>
            </label>
          </div>

          <div class="relative">
            <input type="radio" id="administrativo" name="tipoUsuario" value="21" formControlName="tipoUsuario"
              class="sr-only peer">
            <label for="administrativo"
              class="flex items-center gap-3 p-4 transition-all border-2 border-gray-200 border-solid rounded-lg cursor-pointer hover:border-orange-300 peer-checked:border-orange-500 peer-checked:bg-orange-50">
              <i class="text-xl text-orange-600 pi pi-briefcase"></i>
              <span class="font-medium text-gray-700">Administrativo</span>
            </label>
          </div>

          <div class="relative">
            <input type="radio" id="egresado" name="tipoUsuario" value="14" formControlName="tipoUsuario"
              class="sr-only peer">
            <label for="egresado"
              class="flex items-center gap-3 p-4 transition-all border-2 border-gray-200 border-solid rounded-lg cursor-pointer hover:border-rose-300 peer-checked:border-rose-500 peer-checked:bg-rose-50">
              <i class="text-xl text-rose-600 pi pi-user-edit"></i>
              <span class="font-medium text-gray-700">Egresado</span>
            </label>
          </div>

          <div class="relative">
            <input type="radio" id="graduado" name="tipoUsuario" value="72" formControlName="tipoUsuario"
              class="sr-only peer">
            <label for="graduado"
              class="flex items-center gap-3 p-4 transition-all border-2 border-gray-200 border-solid rounded-lg cursor-pointer hover:border-purple-300 peer-checked:border-purple-500 peer-checked:bg-purple-50">
              <i class="text-xl text-purple-600 pi pi-graduation-cap"></i>
              <span class="font-medium text-gray-700">Graduado</span>
            </label>
          </div>
        </div>
        <p class="mt-3 text-sm text-red-500" *ngIf="isInvalid('tipoUsuario')">
          <i class="mr-1 pi pi-exclamation-circle"></i>
          Seleccione un tipo de usuario.
        </p>
      </div>
    </div>

    <!-- Información Institucional -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-building"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Información Institucional</h2>
            <p class="text-sm text-gray-600">Seleccione su sede o filial</p>
          </div>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 gap-4">
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-filter"></i>
              Filial <span class="text-red-500">*</span>
            </label>

            <app-select-filiales placeholder="Seleccione su Campus" [disabled]="false"
              [selectedValue]="filialSeleccionada" (onSelectionChange)="onFilialSeleccionada($event)">
            </app-select-filiales>

            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('filial')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Seleccione una filial.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Información Personal -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-user"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Información Personal</h2>
            <p class="text-sm text-gray-600">Complete sus datos personales</p>
          </div>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-user"></i>
              Nombres <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="nombre" placeholder="Ingrese su nombre" class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('nombre')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Ingrese su nombre.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-users"></i>
              Apellidos <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="apellidos" placeholder="Ingrese sus apellidos" class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('apellidos')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Ingrese sus apellidos.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-id-card"></i>
              D.N.I o Pasaporte <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="documento" placeholder="12345678" class="w-full" />
            <p class="mt-1 text-xs text-gray-500">Solo números para DNI (8 dígitos) o ingrese su pasaporte.</p>
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('documento')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Documento inválido.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-briefcase"></i>
              Escuela profesional
              <span class="text-red-500" *ngIf="formularioForm.get('tipoUsuario')?.value !== '21'">*</span>
            </label>

            <!-- Mostrar select solo cuando NO es administrativo -->
            <p-select *ngIf="formularioForm.get('tipoUsuario')?.value !== '21'" formControlName="escuelaProfesional"
              [options]="escuelaOptions()" placeholder="Seleccione su escuela profesional" optionLabel="label"
              optionValue="value" [filter]="true" appendTo="body" [style]="{ width: '100%' }" class="w-full"
              [loading]="escuelasLoading()" [disabled]="!hasFilialSelected">
            </p-select>

            <!-- Mensaje cuando es administrativo (reemplaza el select) -->
            <div *ngIf="formularioForm.get('tipoUsuario')?.value === '21'"
              class="p-3 bg-gray-100 border border-gray-300 border-solid rounded-lg">
              <div class="flex items-center gap-2">
                <i class="text-gray-600 pi pi-info-circle"></i>
                <span class="text-sm text-gray-700">Este campo no es requerido para usuarios administrativos</span>
              </div>
            </div>

            <!-- Mensaje cuando no hay filial seleccionada -->
            <div *ngIf="!hasFilialSelected && formularioForm.get('tipoUsuario')?.value !== '21'"
              class="p-3 mt-2 border border-blue-200 rounded-lg bg-blue-50">
              <div class="flex items-center gap-2">
                <i class="text-blue-600 pi pi-info-circle"></i>
                <span class="text-sm text-blue-800">Seleccione primero una filial para ver las escuelas profesionales
                  disponibles</span>
              </div>
            </div>

            <!-- Mensaje cuando está cargando -->
            <div *ngIf="escuelasLoading() && formularioForm.get('tipoUsuario')?.value !== '21'"
              class="p-3 mt-2 border border-blue-200 rounded-lg bg-blue-50">
              <div class="flex items-center gap-2">
                <i class="text-blue-600 pi pi-spin pi-spinner"></i>
                <span class="text-sm text-blue-800">Cargando escuelas profesionales...</span>
              </div>
            </div>

            <!-- Mensaje cuando no hay opciones disponibles -->
            <div
              *ngIf="!escuelasLoading() && hasFilialSelected && escuelaOptions().length === 0 && formularioForm.get('tipoUsuario')?.value !== '21'"
              class="p-3 mt-2 border border-yellow-200 rounded-lg bg-yellow-50">
              <div class="flex items-center gap-2">
                <i class="text-yellow-600 pi pi-exclamation-triangle"></i>
                <span class="text-sm text-yellow-800">No hay escuelas profesionales disponibles para esta filial</span>
              </div>
            </div>

            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('escuelaProfesional')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Seleccione su escuela profesional.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-sliders-h"></i>
              Modalidad
              <span class="text-red-500" *ngIf="formularioForm.get('tipoUsuario')?.value !== '21'">*</span>
            </label>

            <!-- Mostrar select solo cuando NO es administrativo -->
            <p-select *ngIf="formularioForm.get('tipoUsuario')?.value !== '21'" formControlName="modalidad"
              [options]="modalidadOptions()" placeholder="Seleccione la modalidad" optionLabel="label"
              optionValue="value" appendTo="body" [style]="{ width: '100%' }" class="w-full"
              [loading]="modalidadesLoading()">
            </p-select>

            <!-- Mensaje cuando es administrativo (reemplaza el select) -->
            <div *ngIf="formularioForm.get('tipoUsuario')?.value === '21'"
              class="p-3 bg-gray-100 border border-gray-300 border-solid rounded-lg">
              <div class="flex items-center gap-2">
                <i class="text-gray-600 pi pi-info-circle"></i>
                <span class="text-sm text-gray-700">Este campo no es requerido para usuarios administrativos</span>
              </div>
            </div>

            <!-- Mensaje cuando está cargando (solo si NO es administrativo) -->
            <div *ngIf="modalidadesLoading() && formularioForm.get('tipoUsuario')?.value !== '21'"
              class="p-3 mt-2 border border-blue-200 rounded-lg bg-blue-50">
              <div class="flex items-center gap-2">
                <i class="text-blue-600 pi pi-spin pi-spinner"></i>
                <span class="text-sm text-blue-800">Cargando modalidades...</span>
              </div>
            </div>

            <!-- Mensaje cuando no hay opciones disponibles (solo si NO es administrativo) -->
            <div
              *ngIf="!modalidadesLoading() && modalidadOptions().length === 0 && formularioForm.get('tipoUsuario')?.value !== '21'"
              class="p-3 mt-2 border border-yellow-200 rounded-lg bg-yellow-50">
              <div class="flex items-center gap-2">
                <i class="text-yellow-600 pi pi-exclamation-triangle"></i>
                <span class="text-sm text-yellow-800">No hay modalidades disponibles</span>
              </div>
            </div>

            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('modalidad')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Seleccione la modalidad.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-home"></i>
              Domicilio <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="domicilio" placeholder="Ingrese su dirección" class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('domicilio')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Ingrese su domicilio.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-phone"></i>
              Teléfono <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="telefono" placeholder="987654321" class="w-full rounded-lg" />

            <p class="mt-1 text-xs text-gray-500">9 dígitos.</p>
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('telefono')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Ingrese un teléfono válido.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-envelope"></i>
              Correo electrónico para notificación <span class="text-red-500">*</span>
            </label>
            <input pInputText type="email" formControlName="email" placeholder="ejemplo@correo.com" class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('email')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Ingrese un correo válido.
            </p>
          </div>
        </div>
      </div>

      <div class="p-4 mx-6 mt-2 mb-6 border border-solid rounded-lg border-amber-200 bg-amber-50">
        <div class="flex items-center gap-3">
          <p-checkbox binary="true" formControlName="isApoderado" inputId="isApoderado"></p-checkbox>
          <label for="isApoderado" class="text-sm font-medium text-amber-900">
            Soy padre de familia o apoderado y registraré mis datos
          </label>
        </div>

        <div class="grid grid-cols-1 gap-6 mt-4 md:grid-cols-3" *ngIf="formularioForm.get('isApoderado')?.value">
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-amber-600 pi pi-user"></i>
              Apellidos <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="apoderadoApellidos" placeholder="Apellidos del apoderado"
              class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('apoderadoApellidos')">
              <i class="mr-1 pi pi-exclamation-circle"></i> Campo obligatorio.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-amber-600 pi pi-user"></i>
              Nombres <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="apoderadoNombres" placeholder="Nombres del apoderado" class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('apoderadoNombres')">
              <i class="mr-1 pi pi-exclamation-circle"></i> Campo obligatorio.
            </p>
          </div>

          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-amber-600 pi pi-envelope"></i>
              Email <span class="text-red-500">*</span>
            </label>
            <input pInputText type="email" formControlName="apoderadoEmail" placeholder="correo@dominio.com"
              class="w-full" />
            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('apoderadoEmail')">
              <i class="mr-1 pi pi-exclamation-circle"></i> Ingrese un correo válido.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Información Laboral (SOLO PARA ADMINISTRATIVOS) -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl"
      *ngIf="formularioForm.get('tipoUsuario')?.value === '21'">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-building"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Información Laboral</h2>
            <p class="text-sm text-gray-600">Especifique su área de trabajo</p>
          </div>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 gap-4">
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-700">
              <i class="mr-2 text-blue-600 pi pi-home"></i>
              Área/Servicio <span class="text-red-500">*</span>
            </label>
            <p-select formControlName="area" [options]="areaOptions()" placeholder="Seleccione su Área / Servicio"
              optionLabel="label" optionValue="value" [filter]="true" appendTo="body" [style]="{ width: '100%' }"
              class="w-full" [disabled]="!hasFilialSelected">
            </p-select>

            <!-- Mensaje cuando no hay filial seleccionada -->
            <div *ngIf="!hasFilialSelected" class="p-3 mt-2 border border-blue-200 rounded-lg bg-blue-50">
              <div class="flex items-center gap-2">
                <i class="text-blue-600 pi pi-info-circle"></i>
                <span class="text-sm text-blue-800">Seleccione primero una filial para ver las áreas/servicios
                  disponibles</span>
              </div>
            </div>

            <!-- Mensaje cuando no hay opciones disponibles -->
            <div *ngIf="hasFilialSelected && areaOptions().length === 0"
              class="p-3 mt-2 border border-yellow-200 rounded-lg bg-yellow-50">
              <div class="flex items-center gap-2">
                <i class="text-yellow-600 pi pi-exclamation-triangle"></i>
                <span class="text-sm text-yellow-800">No hay áreas/servicios disponibles para esta filial</span>
              </div>
            </div>

            <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('area')">
              <i class="mr-1 pi pi-exclamation-circle"></i>
              Seleccione una opción.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ¿Se ingresó a otra área? -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-inbox"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">¿Este requerimiento se ingresó a otra área?</h2>
            <p class="text-sm text-gray-600">Seleccione al menos una opción</p>
          </div>
        </div>
      </div>

      <div class="p-6">
        <!--  Agregar formGroupName aquí -->
        <div formGroupName="otraArea" class="grid grid-cols-1 gap-3 md:grid-cols-2">
          <label class="flex items-center gap-3">
            <!-- Ahora solo usa formControlName sin el path completo -->
            <p-checkbox formControlName="libro" [binary]="true" inputId="oa-libro"></p-checkbox>
            <span for="oa-libro">Libro de Reclamaciones</span>
          </label>

          <label class="flex items-center gap-3">
            <p-checkbox formControlName="tribunal" [binary]="true" inputId="oa-tribunal"></p-checkbox>
            <span for="oa-tribunal">Tribunal de Honor</span>
          </label>

          <label class="flex items-center gap-3">
            <p-checkbox formControlName="comision" [binary]="true" inputId="oa-comision"></p-checkbox>
            <span for="oa-comision">Comisión de Hostigamiento</span>
          </label>

          <label class="flex items-center gap-3">
            <p-checkbox formControlName="direccion" [binary]="true" inputId="oa-direccion"></p-checkbox>
            <span for="oa-direccion">Dirección General</span>
          </label>

          <label class="flex items-center gap-3">
            <p-checkbox formControlName="secretaria" [binary]="true" inputId="oa-secretaria"></p-checkbox>
            <span for="oa-secretaria">Secretaría General</span>
          </label>

          <label class="flex items-center gap-3">
            <p-checkbox formControlName="cap" [binary]="true" inputId="oa-cap"></p-checkbox>
            <span for="oa-cap">Centro de Atención Personalizada</span>
          </label>

          <div class="md:col-span-2">
            <label class="flex items-center gap-3">
              <p-checkbox formControlName="otro" [binary]="true" inputId="oa-otro"></p-checkbox>
              <span for="oa-otro">Otro <span class="text-sm text-gray-500">(especifique)</span></span>
            </label>

            <div class="mt-2" *ngIf="formularioForm.get('otraArea.otro')?.value">
              <input pInputText formControlName="otraAreaOtro" placeholder="Especifique el área" class="w-full" />
              <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('otraAreaOtro')">
                <i class="mr-1 pi pi-exclamation-circle"></i> Este campo es obligatorio cuando selecciona "Otro".
              </p>
            </div>
          </div>
        </div>

        <!-- <p class="mt-3 text-sm text-red-500"
          *ngIf="formularioForm.get('otraArea')?.errors?.['ningunaSeleccionada'] && (formularioForm.get('otraArea')?.touched || formularioForm.get('otraArea')?.dirty)">
          <i class="mr-1 pi pi-exclamation-circle"></i>
          Debe seleccionar al menos una opción.
        </p> -->
      </div>
    </div>

    <!-- Descripción del Reclamo -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-file-edit"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Descripción de la Denuncia/Reclamo</h2>
            <p class="text-sm text-gray-600">Detalle su denuncia o reclamación</p>
          </div>
        </div>
      </div>
      <div class="p-6">
        <div class="space-y-8">
          <!-- EXPONE -->
          <div>
            <div class="flex items-center gap-3 mb-3">
              <div class="flex items-center p-2 rounded-lg bg-rose-100">
                <i class="text-lg text-rose-600 pi pi-exclamation-circle"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-gray-800">EXPONE:</h3>
                <p class="text-sm text-gray-600">Describa los hechos que originan su reclamo</p>
              </div>
            </div>

            <textarea pTextarea formControlName="expone" rows="6" [autoResize]="true" [invalid]="isInvalid('expone')"
              placeholder="Describa detalladamente los hechos que originan la denuncia o reclamación y el alcance de su pretensión..."
              class="w-full"></textarea>

            <div class="flex justify-between">
              <p class="mt-2 text-xs text-gray-500">
                <i class="mr-1 pi pi-info-circle"></i>
                Mínimo 50 caracteres.
              </p>
              <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('expone')">
                <i class="mr-1 pi pi-exclamation-circle"></i>
                La descripción es muy corta.
              </p>
            </div>
          </div>

          <!-- Divisor -->
          <div class="border-0 border-t border-gray-200 border-solid"></div>

          <!-- SOLICITA -->
          <div>
            <div class="flex items-center gap-3 mb-3">
              <div class="flex items-center p-2 bg-green-100 rounded-lg">
                <i class="text-lg text-green-600 pi pi-check-circle"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-gray-800">SOLICITA:</h3>
                <p class="text-sm text-gray-600">Especifique qué solicita como resolución</p>
              </div>
            </div>

            <textarea pTextarea formControlName="solicita" rows="4" [autoResize]="true"
              [invalid]="isInvalid('solicita')"
              placeholder="Especifique claramente lo que solicita como resolución a su reclamo..."
              class="w-full"></textarea>

            <div class="flex justify-between">
              <p class="mt-2 text-xs text-gray-500">
                <i class="mr-1 pi pi-info-circle"></i>
                Mínimo 20 caracteres.
              </p>
              <p class="mt-1 text-sm text-red-500" *ngIf="isInvalid('solicita')">
                <i class="mr-1 pi pi-exclamation-circle"></i>
                Indique su solicitud con mayor detalle.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Adjuntos -->
    <div class="overflow-hidden bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="px-6 py-4 border-0 border-b border-gray-400 border-solid bg-[#ddeaf3]">
        <div class="flex items-center gap-3">
          <div class="flex items-center p-2 bg-[#105282] rounded-lg">
            <i class="text-lg text-white pi pi-paperclip"></i>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">Adjuntar Evidencias</h2>
            <p class="text-sm text-gray-600">
              Opcional - Puedes adjuntar de 0 a {{ MAX_FILES }} archivos
            </p>
          </div>
        </div>
      </div>

      <div class="p-6">
        <!-- Información sobre archivos -->
        <div class="p-4 mb-6 border border-blue-200 border-solid rounded-lg bg-blue-50">
          <div class="flex items-start gap-3">
            <i class="pi pi-info-circle text-blue-600 text-lg mt-0.5"></i>
            <div class="text-sm text-blue-800">
              <p class="mb-2 font-medium">Información sobre archivos adjuntos:</p>
              <ul class="space-y-1 text-blue-700">
                <li>• <strong>Opcional:</strong> No es obligatorio adjuntar archivos</li>
                <li>• <strong>Formatos permitidos:</strong> PDF, Word, Imágenes, Audio y Video</li>
                <li>• <strong>Tamaño máximo:</strong> {{ formatSize(MAX_FILE_SIZE) }} por archivo</li>
                <li>• <strong>Cantidad:</strong> Puedes subir hasta {{ MAX_FILES }} archivos</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- FileUpload Component -->
        <div class="space-y-4">
          <!-- Botón para seleccionar archivos -->
          <div class="flex justify-center">
            <p-fileupload #fileUpload mode="basic" name="files[]"
              [chooseLabel]="canUploadMore ? 'Seleccionar Archivos (' + selectedFiles.length + '/' + MAX_FILES + ')' : 'Límite Alcanzado'"
              chooseIcon="pi pi-upload" [auto]="true" [multiple]="true" [maxFileSize]="MAX_FILE_SIZE"
              [disabled]="!canUploadMore" (onSelect)="onFileSelect($event)" [showUploadButton]="false"
              [showCancelButton]="false" styleClass="w-full">
            </p-fileupload>
          </div>

          <!-- Mensaje cuando se alcanza el límite -->
          <div *ngIf="!canUploadMore" class="p-4 border border-orange-200 rounded-lg bg-orange-50">
            <div class="flex items-center gap-3">
              <i class="text-lg text-orange-600 pi pi-exclamation-triangle"></i>
              <div>
                <p class="font-medium text-orange-800">Límite de archivos alcanzado</p>
                <p class="text-sm text-orange-700">
                  Has alcanzado el máximo de {{ MAX_FILES }} archivos permitidos.
                  Elimina algún archivo si deseas agregar otro.
                </p>
              </div>
            </div>
          </div>

          <!-- Lista de archivos seleccionados -->
          <div *ngIf="selectedFiles.length > 0" class="space-y-4">
            <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-gray-50">
              <div class="flex items-center gap-2">
                <i class="text-blue-600 pi pi-check-circle"></i>
                <span class="font-medium text-gray-700">
                  {{ selectedFiles.length }} archivo(s) adjuntado(s)
                </span>
                <span class="text-sm text-gray-500">
                  ({{ totalSize }})
                </span>
              </div>
              <p-button label="Limpiar todos" icon="pi pi-trash" severity="danger" size="small" [outlined]="true"
                (onClick)="onClearFiles()">
              </p-button>
            </div>

            <!-- Tarjetas de archivos -->
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
              <div *ngFor="let file of selectedFiles; let i = index"
                class="relative flex flex-col p-4 transition-all border border-gray-200 border-solid rounded-lg hover:shadow-md hover:border-blue-300">

                <!-- Botón eliminar (esquina superior derecha) -->
                <button type="button" (click)="onRemoveFile(i)"
                  class="absolute flex items-center justify-center w-8 h-8 transition-colors bg-red-100 rounded-full top-2 right-2 hover:bg-red-200"
                  [title]="'Eliminar ' + file.name">
                  <i class="text-red-600 pi pi-times"></i>
                </button>

                <!-- Contenido del archivo -->
                <div class="flex items-start gap-3">
                  <!-- Ícono del archivo -->
                  <div class="flex items-center justify-center flex-shrink-0 w-12 h-12 rounded-lg bg-blue-50">
                    <i [class]="'text-2xl text-blue-600 pi ' + getFileIcon(file.name)"></i>
                  </div>

                  <!-- Información del archivo -->
                  <div class="flex-1 min-w-0">
                    <p class="mb-1 text-sm font-medium text-gray-800 truncate" [title]="file.name">
                      {{ file.name }}
                    </p>
                    <div class="flex items-center gap-2 text-xs text-gray-500">
                      <span>{{ formatSize(file.size) }}</span>
                      <span>•</span>
                      <p-badge [value]="getFileExtension(file.name)" [severity]="getFileBadgeSeverity(file.name)">
                      </p-badge>
                    </div>
                  </div>
                </div>

                <!-- Preview para imágenes -->
                <!-- <div *ngIf="isImage(file.name)" class="mt-3">
                  <img [src]="file.objectURL" [alt]="file.name"
                    class="object-cover w-full h-32 border border-gray-200 border-solid rounded-lg">
                </div> -->
              </div>
            </div>
          </div>

          <!-- Mensaje cuando no hay archivos -->
          <div *ngIf="selectedFiles.length === 0"
            class="p-8 text-center border-2 border-gray-200 border-dashed rounded-lg">
            <div class="flex flex-col items-center gap-3">
              <div class="flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full">
                <i class="text-3xl text-gray-400 pi pi-cloud-upload"></i>
              </div>
              <div>
                <p class="font-medium text-gray-700">No hay archivos adjuntos</p>
                <p class="text-sm text-gray-500">Los archivos son opcionales. Puedes continuar sin adjuntar evidencias.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="p-6 bg-white border border-gray-200 border-solid shadow-sm rounded-xl">
      <div class="flex flex-col gap-4 sm:flex-row sm:justify-end">
        <p-button label="Limpiar Formulario" icon="pi pi-refresh" severity="secondary" [outlined]="true" size="large"
          (onClick)="limpiarFormulario()" styleClass="flex-1 sm:flex-initial">
        </p-button>
        <p-button label="Enviar Formulario" icon="pi pi-send" severity="danger" size="large"
          (onClick)="enviarFormulario()" styleClass="flex-1 sm:flex-initial">
        </p-button>
      </div>
    </div>

  </form>
</div>

<!-- Footer (fuera del form) -->
<footer class="p-4 text-white bg-slate-700">
  <div class="flex flex-col gap-2 text-sm sm:flex-row sm:justify-between sm:items-center">
    <div>
      <div class="font-semibold">Defensoría Universitaria</div>
      <div class="text-gray-300">Sistema de Gestión de Denuncias y Reclamos</div>
    </div>
    <div class="text-right text-gray-300">
      <div>Para consultas adicionales, contacte a la Defensoría Universitaria</div>
      <div>© {{ currentYear }} - Todos los derechos reservados</div>
    </div>
  </div>
</footer>