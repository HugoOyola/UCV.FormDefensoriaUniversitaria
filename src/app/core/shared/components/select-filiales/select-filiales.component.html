<div class="select-filiales-container">
  <!-- Estado de carga -->
  <div *ngIf="isLoading()" class="flex items-center justify-center p-4">
    <p-progressSpinner styleClass="w-8 h-8" strokeWidth="4"></p-progressSpinner>
    <span class="ml-3 text-sm text-gray-600">Cargando filiales...</span>
  </div>

  <!-- Estado de error -->
  <div *ngIf="hasError()" class="p-4 border border-red-200 border-solid rounded-lg bg-red-50">
    <div class="flex items-center gap-3">
      <i class="text-red-500 pi pi-exclamation-triangle"></i>
      <div>
        <p class="text-sm font-medium text-red-800">Error al cargar filiales</p>
        <p class="text-xs text-red-600">{{ errorMessage() }}</p>
      </div>
      <p-button
        label="Reintentar"
        icon="pi pi-refresh"
        size="small"
        severity="danger"
        [outlined]="true"
        (onClick)="loadFiliales()">
      </p-button>
    </div>
  </div>

  <!-- Select de filiales -->
  <div *ngIf="!isLoading() && !hasError()">
    <p-select
      [ngModel]="selectedValue"
      (ngModelChange)="onSelectionChange.emit($event)"
      [options]="filialOptions()"
      [placeholder]="placeholder"
      [disabled]="disabled"
      optionLabel="label"
      optionValue="value"
      [filter]="true"
      filterBy="label"
      appendTo="body"
      [style]="{ width: '100%' }"
      class="w-full">

      <ng-template pTemplate="selectedItem" let-option>
        <div *ngIf="option" class="flex items-center gap-2">
          <i class="text-blue-600 pi pi-building"></i>
          <span>{{ option.value.cPerApellido }}</span>
        </div>
      </ng-template>

      <ng-template pTemplate="item" let-option>
        <div class="flex items-center justify-between w-full gap-3 p-2">
          <div class="flex items-center gap-2">
            <i class="text-blue-600 pi pi-building"></i>
            <div>
              <div class="font-medium">{{ option.value.cPerApellido }}</div>
              <div class="text-xs text-gray-500">{{ option.value.descr }}</div>
            </div>
          </div>
          <div class="text-xs text-gray-400">
            {{ option.value.pS_ESTABID }}
          </div>
        </div>
      </ng-template>
    </p-select>

    <!-- Mensaje cuando no hay filiales -->
    <div *ngIf="filialOptions().length === 0" class="p-4 text-center border border-gray-200 border-solid rounded-lg bg-gray-50">
      <i class="text-2xl text-gray-400 pi pi-info-circle"></i>
      <p class="mt-2 text-sm text-gray-600">No hay filiales disponibles</p>
    </div>
  </div>
</div>